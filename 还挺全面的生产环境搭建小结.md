## 生产环境搭建小结

### 概览

- 服务器
- PHP7.1+Mysql5.7+Nginx
- PHP的一些工具
  - composer
- NodeJs
- NodeJs一些工具和设置
  - cnpm
  - pm2
  - Nginx反向代理Node运行程序
- Git设置（SSH密钥生成）
- Nginx设置Https
- 服务器使用ssh免密登录


### 服务器

#### Centos和Ubuntu的简单介绍（算是我自己的补习）

- CentOS（Community ENTerprise Operating System）是Linux发行版之一，它是来自于Red Hat Enterprise Linux依照开放源代码规定释出的源代码所编译而成。由于出自同样的源代码，因此有些要求高度稳定性的服务器以CentOS替代商业版的Red Hat Enterprise Linux使用。

- Ubuntu是一个以桌面应用为主的Linux操作系统。Ubuntu基于Debian发行版和GNOME桌面环境，与Debian的不同在于它每6个月会发布一个新版本。Ubuntu的目标在于为一般用户提供一个最新的、同时又相当稳定的主要由自由软件构建而成的操作系统。Ubuntu具有庞大的社区力量，用户可以方便地从社区获得帮助。

> 两者同为目前版本中个人和小团队常用的服务级操作系统，在线提供的软件库中可以很方便的安装到很多开源的软件及库两者都使用bash作为基础shell，所以在很多基础命令上，ubuntu与centos的差别不是很明显，而ubuntu在桌面界面上要做的更为出色。


#### Centos和Ubuntu区别

1. root用户的区别

centos中新建的非root用户是没有sudo的权限的，如果需要使用sudo权限必须在/etc/sudoers 中加入账户和权限，所以切换到root账号的时候只需要输入：`su`,然后回车,根据提示输入root账号的密码即可,如附图：
![](https://ws1.sinaimg.cn/large/6aedb651gy1fh1ryr3dm1j20et01qt8n.jpg)

在Ubuntu中，一般使用sudo+命令来执行root权限，比如`sudo rm -rf  ./test.txt`，如果是第一次使用会提示输入当前用户的密码（而不是root的密码）

2. 在线软件安装的区别

centos使用的是yum命令，除此之外yum中还有一个从软件源中搜索摸个软件的方法yum search +软件名

ubuntu中使用的是apt-get命令

3. centos是来自于redhat，所以centos支持rpm格式的安装，而ubuntu显然是不支持的

4. 毕竟是不同的公司做的不同的发行版，很多配置文件的位置和默认的文件路径都有很大区别，这个需要使用过程中慢慢体会了。


#### 选择

就个人喜好而言，作为服务器我更倾向于`Centos`,可能是先入为主的思想吧，从开始编程到现在一年多时间，接触更多的也是`Centos`，包括自己博客的服务器也是用的它。期间也在虚拟机中安装过Ubuntu桌面版，并使用的一段时间，就作为个人PC而言，Ubuntu的可用性和用户友好性远远高于centos这是毋庸置疑的。

虽然个人喜欢centos更多，但出于其他原因的考虑，比如上面说到的Ubuntu具有庞大的社区力量等诸多方面的因素，这次选择了Ubuntu作为生产服务器。正好顺势多接触一下。

服务器系统：Ubuntu 16.04 64位，
服务器供应商：阿里云


### 安装lnmp环境


> lnmp 的全称是linux + nginx + mysql + php

我们这里使用的是lnmp的一键安装包，[lnmp](https://blog.linuxeye.cn/31.html)

#### 安装步骤

```
#阿里云经典网络内网下载
wget http://aliyun-oss.linuxeye.com/lnmp-full.tar.gz 
# 包含源码，国内外均可下载
wget http://mirrors.linuxeye.com/lnmp-full.tar.gz 
# 不包含源码，建议仅国外主机下载
wget http://mirrors.linuxeye.com/lnmp.tar.gz 

# 解压
tar xzf lnmp-full.tar.gz


cd lnmp # 如果需要修改目录(安装、数据存储、Nginx日志)，请修改options.conf文件

# 安装
./install.sh 

```

**详细安装和使用教程请参考[运维笔记](https://blog.linuxeye.cn/31.html)**

> 默认安装的php是不包含`fileinfo`扩展的，若需要请在lnmp目录执行`./addons.sh`自请添加

> 另外，php是默认将一些php函数禁用的，像`system`等，若需要请去php.ini将禁用的函数开启。


### PHP的一些工具

#### composer安装

```
# 下载
wget https://getcomposer.org/composer.phar

# 下载的 composer.phar 文件移动到 /usr/local/bin/ 目录下
mv composer.phar /usr/local/bin/composer

# 给/usr/local/bin/composer下可执行权限
chmod -R 775 /usr/local/bin/composer

# 设置中国全量镜像
composer config -g repo.packagist composer https://packagist.phpcomposer.com
```

> composer中国全量镜像使用请参开[Packagist/Composer中国全量镜像](https://pkg.phpcomposer.com/#how-to-install-composer)


### NodeJs